(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d965628"],{a5bc:function(e,t,o){},cabb:function(e,t,o){"use strict";o.r(t);o("b0c0"),o("a4d3"),o("e01a");var r=o("7a23");Object(r["pushScopeId"])("data-v-8b98a4c4");var l={class:"preImg"},n=["src"],c=Object(r["createTextVNode"])("更换图片"),i=Object(r["createElementVNode"])("i",{class:"el-icon-plus"},null,-1),a=["src"],s=Object(r["createTextVNode"])("保存"),u=Object(r["createTextVNode"])("返回");function m(e,t,o,m,d,b){var h=Object(r["resolveComponent"])("el-button"),g=Object(r["resolveComponent"])("el-upload"),f=Object(r["resolveComponent"])("el-dialog"),p=Object(r["resolveComponent"])("el-input"),j=Object(r["resolveComponent"])("el-form-item"),O=Object(r["resolveComponent"])("el-option"),w=Object(r["resolveComponent"])("el-select"),v=Object(r["resolveComponent"])("el-form"),F=Object(r["resolveDirective"])("loading");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("img",{src:d.preImgUrl,alt:"加载中"},null,8,n)],512),[[r["vShow"],d.showPreImg]]),Object(r["withDirectives"])(Object(r["createVNode"])(h,{type:"primary",onClick:t[0]||(t[0]=function(e){return d.showPreImg=!d.showPreImg}),plain:"",class:"changeBtn"},{default:Object(r["withCtx"])((function(){return[c]})),_:1},512),[[r["vShow"],d.showPreImg]]),Object(r["withDirectives"])(Object(r["createVNode"])(g,{action:"#","list-type":"picture-card","file-list":d.fileList,"on-remove":b.handleRemove,"on-change":b.loadImg,"auto-upload":!1,"http-request":b.myupload,ref:"upload",class:"img-upload",limit:"1"},{default:Object(r["withCtx"])((function(){return[i]})),_:1},8,["file-list","on-remove","on-change","http-request"]),[[r["vShow"],!d.showPreImg]]),Object(r["createVNode"])(f,{modelValue:d.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=function(e){return d.dialogVisible=e})},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("img",{width:"100%",src:d.dialogImageUrl,alt:""},null,8,a)]})),_:1},8,["modelValue"]),Object(r["createVNode"])(v,{model:d.ruleForm,rules:d.rules,ref:"ruleForm","label-width":"100px",class:"demo-ruleForm"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(j,{label:"商品名称",prop:"name"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(p,{modelValue:d.ruleForm.name,"onUpdate:modelValue":t[2]||(t[2]=function(e){return d.ruleForm.name=e})},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(j,{label:"商品简介",prop:"description"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(p,{modelValue:d.ruleForm.description,"onUpdate:modelValue":t[3]||(t[3]=function(e){return d.ruleForm.description=e})},null,8,["modelValue"])]})),_:1}),d.categories?(Object(r["openBlock"])(),Object(r["createBlock"])(j,{key:0,label:"商品类别",prop:"category"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(w,{modelValue:d.ruleForm.category,"onUpdate:modelValue":t[4]||(t[4]=function(e){return d.ruleForm.category=e}),placeholder:"请选择商品类别"},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(d.categories,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])(O,{key:t,label:e,value:e},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})):Object(r["createCommentVNode"])("",!0)]})),_:1},8,["model","rules"]),Object(r["withDirectives"])(Object(r["createVNode"])(h,{type:"primary",onClick:b.submitUpload,"element-loading-text":"上传中"},{default:Object(r["withCtx"])((function(){return[s]})),_:1},8,["onClick"]),[[F,d.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}],[r["vShow"],d.showSubmitBtn]]),Object(r["createVNode"])(h,{onClick:b.goback},{default:Object(r["withCtx"])((function(){return[u]})),_:1},8,["onClick"])],64)}Object(r["popScopeId"])();var d=o("4995"),b=o("c72e"),h=o.n(b),g=o("a18c"),f={props:["objFileId","objId"],name:"addForm",data:function(){return{ruleForm:{name:"",description:"",category:"",img:null},rules:{name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{message:"长度在 3 到 5 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择商品类别",trigger:"change"}]},categories:["干货","特产","其他"],dialogImageUrl:"",dialogVisible:!1,fullscreenLoading:!1,fileList:[],showPreImg:!0,showSubmitBtn:!0,preImgUrl:"",objInfo:null}},methods:{checkParam:function(){console.log(this.objFileId),console.log(this.objId)},handleRemove:function(e,t){console.log(e)},submitUpload:function(){var e=this;if(this.ruleForm.img){console.log("new img");var t=this.objInfo.fileId,o=h.a.File.createWithoutData(t);o.destroy();var r=new h.a.File(this.ruleForm.img.name,this.ruleForm.img);this.fullscreenLoading=!0,r.save().then((function(t){e.updateObj(t),e.preImgUrl=t.url(),e.showPreImg=!0,e.fileList=[]})).catch((function(t){e.fullscreenLoading=!1,e.showErrorMessage("图片上传失败: "+t)}))}else this.updateObj(null)},updateObj:function(e){var t=this,o=h.a.Object.createWithoutData("item",this.objInfo.objectId);if(o.set("name",this.ruleForm.name),o.set("description",this.ruleForm.description),o.set("category",this.ruleForm.category),e){var r=[e];o.set("img",r)}this.fullscreenLoading=!0,o.save().then((function(e){t.showSuccessMessage("商品信息更新成功"),t.showSubmitBtn=!1,t.fullscreenLoading=!1}),(function(e){console.log(e),t.fullscreenLoading=!1,t.showSubmitBtn=!1,t.showErrorMessage("上传失败: "+e)}))},loadImg:function(e,t){console.log("handle img"),this.ruleForm.img=e.raw,console.log(this.ruleForm.img)},showSuccessMessage:function(e){Object(d["a"])({showClose:!0,type:"success",message:e})},showErrorMessage:function(e){Object(d["a"])({showClose:!0,type:"error",message:e})},myupload:function(){""!==this.ruleForm.name&&""!==this.ruleForm.category?(this.fullscreenLoading=!0,this.uploadObj()):this.showErrorMessage("信息不完整")},uploadObj:function(){},goback:function(){g["a"].push("/")},resetForm:function(e){this.$refs[e].resetFields(),this.fileList=[]},fillForm:function(e){this.ruleForm.name=e.name,this.ruleForm.description=e.description,this.ruleForm.category=e.category,this.preImgUrl=e.url}},created:function(){var e=this.$route.params;this.fillForm(e),this.objInfo=e}},p=(o("f110"),o("d959")),j=o.n(p);const O=j()(f,[["render",m],["__scopeId","data-v-8b98a4c4"]]);t["default"]=O},f110:function(e,t,o){"use strict";o("a5bc")}}]);
//# sourceMappingURL=chunk-6d965628.f02bc6d7.js.map