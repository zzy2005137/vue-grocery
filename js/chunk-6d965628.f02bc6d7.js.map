{"version":3,"sources":["webpack:///./src/components/updateForm.vue","webpack:///./src/components/updateForm.vue?714f","webpack:///./src/components/updateForm.vue?47f9"],"names":["class","src","preImgUrl","alt","showPreImg","type","plain","action","list-type","file-list","fileList","on-remove","handleRemove","on-change","loadImg","auto-upload","http-request","myupload","ref","limit","dialogVisible","width","dialogImageUrl","model","ruleForm","rules","label-width","label","prop","name","description","categories","category","placeholder","index","key","value","submitUpload","element-loading-text","fullscreenLoading","showSubmitBtn","goback","props","data","img","required","message","trigger","objInfo","methods","checkParam","console","log","this","objFileId","objId","file","targetId","fileId","File","createWithoutData","destroy","newFile","save","then","res","updateObj","url","catch","error","showErrorMessage","item","Object","objectId","set","files","showSuccessMessage","raw","msg","showClose","uploadObj","router","push","resetForm","$refs","resetFields","fillForm","created","$route","params","__exports__","render"],"mappings":"+OACOA,MAAM,U,yCASR,Q,EAgBD,gCAA4B,KAAzBA,MAAM,gBAAc,S,yCAqCtB,M,+BAGwB,M,+hBAjE3B,gCAEM,MAFN,EAEM,CADJ,gCAAkC,OAA5BC,IAAK,EAAAC,UAAWC,IAAI,O,6BADA,EAAAC,c,4BAG5B,yBAOC,GANCC,KAAK,UACJ,QAAK,+BAAE,EAAAD,YAAc,EAAAA,aAEtBE,MAAA,GACAN,MAAM,a,+BACL,iBAAI,C,6BAHG,EAAAI,c,4BAMV,yBAcY,GAbVG,OAAO,IACPC,YAAU,eACTC,YAAW,EAAAC,SACXC,YAAW,EAAAC,aACXC,YAAW,EAAAC,QACXC,eAAa,EACbC,eAAc,EAAAC,SACfC,IAAI,SACJlB,MAAM,aACNmB,MAAM,K,+BAGN,iBAA4B,CAA5B,M,2EAFS,EAAAf,cAIX,yBAEY,G,WAFQ,EAAAgB,c,qDAAA,EAAAA,cAAa,K,+BAC/B,iBAAiD,CAAjD,gCAAiD,OAA5CC,MAAM,OAAQpB,IAAK,EAAAqB,eAAgBnB,IAAI,I,qCAG9C,yBAuBU,GAtBPoB,MAAO,EAAAC,SACPC,MAAO,EAAAA,MACRP,IAAI,WACJQ,cAAY,QACZ1B,MAAM,iB,+BAEN,iBAEe,CAFf,yBAEe,GAFD2B,MAAM,OAAOC,KAAK,Q,+BAC9B,iBAA6C,CAA7C,yBAA6C,G,WAA1B,EAAAJ,SAASK,K,qDAAT,EAAAL,SAASK,KAAI,K,iCAElC,yBAEe,GAFDF,MAAM,OAAOC,KAAK,e,+BAC9B,iBAAoD,CAApD,yBAAoD,G,WAAjC,EAAAJ,SAASM,Y,qDAAT,EAAAN,SAASM,YAAW,K,iCAErB,EAAAC,Y,yBAApB,yBASe,G,MATiBJ,MAAM,OAAOC,KAAK,Y,+BAChD,iBAOY,CAPZ,yBAOY,G,WAPQ,EAAAJ,SAASQ,S,qDAAT,EAAAR,SAASQ,SAAQ,IAAEC,YAAY,W,+BAE/C,iBAAuC,E,2BADzC,gCAKa,2CAJiB,EAAAF,YAAU,SAA9BC,EAAUE,G,gCADpB,yBAKa,GAHVC,IAAKD,EACLP,MAAOK,EACPI,MAAOJ,G,0KAMhB,yBAOC,GANC3B,KAAK,UACJ,QAAO,EAAAgC,aAERC,uBAAqB,O,+BAEpB,iBAAE,C,8BAHwB,EAAAC,uB,eAA3B,E,MAAA,I,YAEQ,EAAAC,iBAIV,yBAAyC,GAA7B,QAAO,EAAAC,QAAM,C,8BAAE,iBAAE,C,0GAQhB,GACbC,MAAO,CAAC,YAAa,SACrBb,KAAM,UACNc,KAHa,WAIX,MAAO,CACLnB,SAAU,CACRK,KAAM,GACNC,YAAa,GACbE,SAAU,GACVY,IAAK,MAEPnB,MAAO,CACLI,KAAM,CACJ,CAAEgB,UAAU,EAAMC,QAAS,UAAWC,QAAS,QAC/C,CACED,QAAS,gBACTC,QAAS,SAGbf,SAAU,CACR,CAAEa,UAAU,EAAMC,QAAS,UAAWC,QAAS,YAInDhB,WAAY,CAAC,KAAM,KAAM,MACzBT,eAAgB,GAChBF,eAAe,EACfmB,mBAAmB,EACnB7B,SAAU,GACVN,YAAY,EACZoC,eAAe,EACftC,UAAW,GACX8C,QAAS,OAGbC,QAAS,CACPC,WADO,WAELC,QAAQC,IAAIC,KAAKC,WACjBH,QAAQC,IAAIC,KAAKE,QAEnB3C,aALO,SAKM4C,EAAM9C,GACjByC,QAAQC,IAAII,IAEdnB,aARO,WAQQ,WACb,GAAIgB,KAAK7B,SAASoB,IAAK,CACrBO,QAAQC,IAAI,WAGZ,IAAIK,EAAWJ,KAAKL,QAAQU,OACtBF,EAAO,IAAGG,KAAKC,kBAAkBH,GACvCD,EAAKK,UAGL,IAAMC,EAAU,IAAI,IAAGH,KAAKN,KAAK7B,SAASoB,IAAIf,KAAMwB,KAAK7B,SAASoB,KAClES,KAAKd,mBAAoB,EACzBuB,EACGC,OACAC,MAAK,SAACC,GAEL,EAAKC,UAAUD,GAGf,EAAK/D,UAAY+D,EAAIE,MACrB,EAAK/D,YAAa,EAClB,EAAKM,SAAW,MAEjB0D,OAAM,SAACC,GACN,EAAK9B,mBAAoB,EACzB,EAAK+B,iBAAiB,WAAaD,WAGvChB,KAAKa,UAAU,OAKnBA,UAzCO,SAyCGV,GAAM,WACRe,EAAO,IAAGC,OAAOZ,kBAAkB,OAAQP,KAAKL,QAAQyB,UAI9D,GAHAF,EAAKG,IAAI,OAAQrB,KAAK7B,SAASK,MAC/B0C,EAAKG,IAAI,cAAerB,KAAK7B,SAASM,aACtCyC,EAAKG,IAAI,WAAYrB,KAAK7B,SAASQ,UAC/BwB,EAAM,CACR,IAAImB,EAAQ,CAACnB,GACbe,EAAKG,IAAI,MAAOC,GAElBtB,KAAKd,mBAAoB,EACzBgC,EAAKR,OAAOC,MACV,SAACC,GAEC,EAAKW,mBAAL,YACA,EAAKpC,eAAgB,EACrB,EAAKD,mBAAoB,KAE3B,SAAC8B,GACClB,QAAQC,IAAIiB,GACZ,EAAK9B,mBAAoB,EACzB,EAAKC,eAAgB,EACrB,EAAK8B,iBAAiB,SAAWD,OAKvCvD,QAnEO,SAmEC0C,EAAM9C,GACZyC,QAAQC,IAAI,cACZC,KAAK7B,SAASoB,IAAMY,EAAKqB,IACzB1B,QAAQC,IAAIC,KAAK7B,SAASoB,MAM5BgC,mBA5EO,SA4EYE,GACjB,eAAU,CACRC,WAAW,EACX1E,KAAM,UACNyC,QAASgC,KAGbR,iBAnFO,SAmFUQ,GACf,eAAU,CACRC,WAAW,EACX1E,KAAM,QACNyC,QAASgC,KAGb7D,SA1FO,WA4FsB,KAAvBoC,KAAK7B,SAASK,MAA0C,KAA3BwB,KAAK7B,SAASQ,UAM/CqB,KAAKd,mBAAoB,EACzBc,KAAK2B,aANH3B,KAAKiB,iBAAiB,UAQ1BU,UArGO,aA0IPvC,OA1IO,WA2ILwC,EAAA,KAAOC,KAAK,MAGdC,UA9IO,SA8IG3D,GACR6B,KAAK+B,MAAM5D,GAAU6D,cACrBhC,KAAK3C,SAAW,IAElB4E,SAlJO,SAkJEtC,GACPK,KAAK7B,SAASK,KAAOmB,EAAQnB,KAC7BwB,KAAK7B,SAASM,YAAckB,EAAQlB,YACpCuB,KAAK7B,SAASQ,SAAWgB,EAAQhB,SACjCqB,KAAKnD,UAAY8C,EAAQmB,MAG7BoB,QA5La,WA6LX,IAAIvC,EAAUK,KAAKmC,OAAOC,OAC1BpC,KAAKiC,SAAStC,GACdK,KAAKL,QAAUA,I,iCClQnB,MAAM0C,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAE1E,gB,kCCTf","file":"js/chunk-6d965628.f02bc6d7.js","sourcesContent":["<template>\n  <div class=\"preImg\" v-show=\"showPreImg\">\n    <img :src=\"preImgUrl\" alt=\"加载中\" />\n  </div>\n  <el-button\n    type=\"primary\"\n    @click=\"showPreImg = !showPreImg\"\n    v-show=\"showPreImg\"\n    plain\n    class=\"changeBtn\"\n    >更换图片</el-button\n  >\n\n  <el-upload\n    action=\"#\"\n    list-type=\"picture-card\"\n    :file-list=\"fileList\"\n    :on-remove=\"handleRemove\"\n    :on-change=\"loadImg\"\n    :auto-upload=\"false\"\n    :http-request=\"myupload\"\n    ref=\"upload\"\n    class=\"img-upload\"\n    limit=\"1\"\n    v-show=\"!showPreImg\"\n  >\n    <i class=\"el-icon-plus\"></i>\n  </el-upload>\n  <el-dialog v-model=\"dialogVisible\">\n    <img width=\"100%\" :src=\"dialogImageUrl\" alt=\"\" />\n  </el-dialog>\n\n  <el-form\n    :model=\"ruleForm\"\n    :rules=\"rules\"\n    ref=\"ruleForm\"\n    label-width=\"100px\"\n    class=\"demo-ruleForm\"\n  >\n    <el-form-item label=\"商品名称\" prop=\"name\">\n      <el-input v-model=\"ruleForm.name\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"商品简介\" prop=\"description\">\n      <el-input v-model=\"ruleForm.description\"></el-input>\n    </el-form-item>\n    <el-form-item v-if=\"categories\" label=\"商品类别\" prop=\"category\">\n      <el-select v-model=\"ruleForm.category\" placeholder=\"请选择商品类别\">\n        <el-option\n          v-for=\"(category, index) in categories\"\n          :key=\"index\"\n          :label=\"category\"\n          :value=\"category\"\n        ></el-option>\n      </el-select>\n    </el-form-item>\n  </el-form>\n\n  <el-button\n    type=\"primary\"\n    @click=\"submitUpload\"\n    v-loading.fullscreen.lock=\"fullscreenLoading\"\n    element-loading-text=\"上传中\"\n    v-show=\"showSubmitBtn\"\n    >保存</el-button\n  >\n\n  <el-button @click=\"goback\">返回</el-button>\n</template>\n\n<script>\nimport { ElMessage } from \"element-plus\";\nimport AV from \"leancloud-storage\";\nimport router from \"../router\";\n\nexport default {\n  props: [\"objFileId\", \"objId\"],\n  name: \"addForm\",\n  data() {\n    return {\n      ruleForm: {\n        name: \"\",\n        description: \"\",\n        category: \"\",\n        img: null,\n      },\n      rules: {\n        name: [\n          { required: true, message: \"请输入商品名称\", trigger: \"blur\" },\n          {\n            message: \"长度在 3 到 5 个字符\",\n            trigger: \"blur\",\n          },\n        ],\n        category: [\n          { required: true, message: \"请选择商品类别\", trigger: \"change\" },\n        ],\n      },\n\n      categories: [\"干货\", \"特产\", \"其他\"],\n      dialogImageUrl: \"\",\n      dialogVisible: false,\n      fullscreenLoading: false,\n      fileList: [],\n      showPreImg: true,\n      showSubmitBtn: true,\n      preImgUrl: \"\",\n      objInfo: null,\n    };\n  },\n  methods: {\n    checkParam() {\n      console.log(this.objFileId);\n      console.log(this.objId);\n    },\n    handleRemove(file, fileList) {\n      console.log(file);\n    },\n    submitUpload() {\n      if (this.ruleForm.img) {\n        console.log(\"new img\");\n\n        //删除文件\n        var targetId = this.objInfo.fileId;\n        const file = AV.File.createWithoutData(targetId);\n        file.destroy();\n\n        // 上传新文件\n        const newFile = new AV.File(this.ruleForm.img.name, this.ruleForm.img);\n        this.fullscreenLoading = true;\n        newFile\n          .save()\n          .then((res) => {\n            //上传成功后，更新对象信息\n            this.updateObj(res);\n\n            //显示预览\n            this.preImgUrl = res.url();\n            this.showPreImg = true;\n            this.fileList = [];\n          })\n          .catch((error) => {\n            this.fullscreenLoading = false;\n            this.showErrorMessage(\"图片上传失败: \" + error);\n          });\n      } else {\n        this.updateObj(null);\n      }\n      //   trigger submit\n      // this.$refs.upload.submit()\n    },\n    updateObj(file) {\n      const item = AV.Object.createWithoutData(\"item\", this.objInfo.objectId);\n      item.set(\"name\", this.ruleForm.name);\n      item.set(\"description\", this.ruleForm.description);\n      item.set(\"category\", this.ruleForm.category);\n      if (file) {\n        var files = [file];\n        item.set(\"img\", files);\n      }\n      this.fullscreenLoading = true;\n      item.save().then(\n        (res) => {\n          // 成功保存之后，执行其他逻辑\n          this.showSuccessMessage(`商品信息更新成功`);\n          this.showSubmitBtn = false;\n          this.fullscreenLoading = false;\n        },\n        (error) => {\n          console.log(error);\n          this.fullscreenLoading = false;\n          this.showSubmitBtn = false;\n          this.showErrorMessage(\"上传失败: \" + error);\n          // 异常处理\n        }\n      );\n    },\n    loadImg(file, fileList) {\n      console.log(\"handle img\");\n      this.ruleForm.img = file.raw;\n      console.log(this.ruleForm.img);\n\n      // fileList.forEach((element) => {\n      //   console.log(element.raw)\n      // })\n    },\n    showSuccessMessage(msg) {\n      ElMessage({\n        showClose: true,\n        type: \"success\",\n        message: msg,\n      });\n    },\n    showErrorMessage(msg) {\n      ElMessage({\n        showClose: true,\n        type: \"error\",\n        message: msg,\n      });\n    },\n    myupload() {\n      //验证表单\n      if (this.ruleForm.name === \"\" || this.ruleForm.category === \"\") {\n        this.showErrorMessage(\"信息不完整\");\n        return;\n      }\n\n      //屏幕锁定，上传中....\n      this.fullscreenLoading = true;\n      this.uploadObj();\n    },\n    uploadObj() {\n      // const file = new AV.File(this.ruleForm.img.name, this.ruleForm.img)\n      // file.save().then(\n      //   (file) => {\n      //     console.log(`图片保存完成。URL：${file.url()}`)\n      //     // 创建对象，关联已上传图片\n      //     const Item = AV.Object.extend(\"item\")\n      //     const localItem = new Item()\n      //     localItem.set(\"name\", this.ruleForm.name)\n      //     localItem.set(\"description\", this.ruleForm.description)\n      //     localItem.set(\"category\", this.ruleForm.category)\n      //     // attachments 是一个 Array 属性\n      //     localItem.add(\"img\", file)\n      //     localItem.save().then(\n      //       (res) => {\n      //         // 成功保存之后，执行其他逻辑\n      //         this.showSuccessMessage(`商品信息上传成功`)\n      //         this.fullscreenLoading = false\n      //         this.resetForm(\"ruleForm\")\n      //       },\n      //       (error) => {\n      //         console.log(error)\n      //         this.fullscreenLoading = false\n      //         this.showErrorMessage(\"上传失败: \" + error)\n      //         // 异常处理\n      //       }\n      //     )\n      //   },\n      //   (error) => {\n      //     // 保存失败，可能是文件无法被读取，或者上传过程中出现问题\n      //     console.log(error)\n      //     // this.showErrorMessage(\"上传失败，请重置后重试\")\n      //     this.fullscreenLoading = false\n      //     this.showErrorMessage(\"上传失败: \" + error)\n      //   }\n      // )\n    },\n    goback() {\n      router.push(\"/\");\n    },\n\n    resetForm(ruleForm) {\n      this.$refs[ruleForm].resetFields();\n      this.fileList = [];\n    },\n    fillForm(objInfo) {\n      this.ruleForm.name = objInfo.name;\n      this.ruleForm.description = objInfo.description;\n      this.ruleForm.category = objInfo.category;\n      this.preImgUrl = objInfo.url;\n    },\n  },\n  created() {\n    var objInfo = this.$route.params;\n    this.fillForm(objInfo);\n    this.objInfo = objInfo;\n  },\n};\n</script>\n\n<style scoped>\n.img-upload {\n  margin: 2rem 0;\n}\n\n.img {\n  width: 10rem;\n  height: 10rem;\n  overflow: hidden;\n}\nimg {\n  width: 100%;\n}\n.preImg {\n  width: 10rem;\n  min-height: 10rem;\n  overflow: hidden;\n  margin: 1rem auto;\n  border-radius: 0.5rem;\n}\n.changeBtn {\n  margin-bottom: 1rem;\n}\n</style>\n","import { render } from \"./updateForm.vue?vue&type=template&id=8b98a4c4&scoped=true\"\nimport script from \"./updateForm.vue?vue&type=script&lang=js\"\nexport * from \"./updateForm.vue?vue&type=script&lang=js\"\n\nimport \"./updateForm.vue?vue&type=style&index=0&id=8b98a4c4&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\桌面\\\\学习\\\\vue\\\\vue-grocery\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-8b98a4c4\"]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./updateForm.vue?vue&type=style&index=0&id=8b98a4c4&scoped=true&lang=css\""],"sourceRoot":""}